# Coach Notes Migration Guide

This document explains the migration from the previous `instructions` field to the new `coachNotes` structure in the Exercise API.

## Overview of Changes

The Exercise API has been updated to replace the single `instructions` text field with a more structured `coachNotes` array. This change provides:
- Better organization of exercise instructions
- Step-by-step guidance for users
- Ability to reorder instructions
- More flexible content management

## Data Structure Changes

### Previous Structure (Deprecated)
```javascript
{
  id: "exercise-uuid",
  name: "Barbell Back Squat",
  description: "A fundamental compound exercise...",
  instructions: "1. Position the barbell on your upper back\n2. Keep your chest up...", // Single text field
  // ... other fields
}
```

### New Structure
```javascript
{
  id: "exercise-uuid",
  name: "Barbell Back Squat",
  description: "A fundamental compound exercise...",
  coachNotes: [
    {
      id: "coachnote-uuid-1",
      text: "Position the barbell on your upper back",
      order: 0
    },
    {
      id: "coachnote-uuid-2",
      text: "Keep your chest up and core engaged",
      order: 1
    },
    {
      id: "coachnote-uuid-3",
      text: "Lower yourself by bending at the knees and hips",
      order: 2
    }
  ],
  // ... other fields
}
```

## CoachNote Structure

Each coach note has the following properties:

- **`id`**: Unique identifier in format "coachnote-{guid}" (generated by API for existing notes)
- **`text`**: The instructional text (max 1000 characters)
- **`order`**: Zero-based integer indicating display order

## API Request Changes

### Creating an Exercise

When creating a new exercise, provide coach notes as an array:

```javascript
// POST /api/exercises
{
  name: "Barbell Back Squat",
  description: "A fundamental compound exercise...",
  coachNotes: [
    { text: "Position the barbell on your upper back", order: 0 },
    { text: "Keep your chest up and core engaged", order: 1 },
    { text: "Lower yourself by bending at the knees and hips", order: 2 }
  ],
  // ... other fields
}
```

Note: When creating new coach notes, don't include the `id` field - it will be generated by the API.

### Updating an Exercise

When updating an exercise, you can:
1. Add new coach notes (omit `id`)
2. Update existing coach notes (include `id`)
3. Reorder coach notes (change `order` values)
4. Remove coach notes (omit them from the array)

```javascript
// PUT /api/exercises/{id}
{
  name: "Barbell Back Squat",
  description: "Updated description...",
  coachNotes: [
    { 
      id: "coachnote-existing-1", // Existing note
      text: "Updated text for existing note",
      order: 0
    },
    { 
      text: "This is a new coach note", // New note (no id)
      order: 1
    }
  ],
  // ... other fields
}
```

## UI Implementation Guidelines

### Coach Notes Editor Component

Create a dynamic coach notes editor that allows:

```javascript
const CoachNotesEditor = ({ coachNotes, onChange }) => {
  const [notes, setNotes] = useState(coachNotes || []);

  const addNote = () => {
    const newNote = {
      text: '',
      order: notes.length
    };
    const updated = [...notes, newNote];
    setNotes(updated);
    onChange(updated);
  };

  const updateNote = (index, text) => {
    const updated = [...notes];
    updated[index] = { ...updated[index], text };
    setNotes(updated);
    onChange(updated);
  };

  const removeNote = (index) => {
    const updated = notes.filter((_, i) => i !== index);
    // Reorder remaining notes
    updated.forEach((note, i) => {
      note.order = i;
    });
    setNotes(updated);
    onChange(updated);
  };

  const moveNote = (fromIndex, toIndex) => {
    const updated = [...notes];
    const [removed] = updated.splice(fromIndex, 1);
    updated.splice(toIndex, 0, removed);
    // Update order values
    updated.forEach((note, i) => {
      note.order = i;
    });
    setNotes(updated);
    onChange(updated);
  };

  return (
    <div className="coach-notes-editor">
      <h3>Coach Notes</h3>
      {notes.map((note, index) => (
        <div key={note.id || `new-${index}`} className="coach-note-item">
          <span className="note-number">{index + 1}.</span>
          <textarea
            value={note.text}
            onChange={(e) => updateNote(index, e.target.value)}
            placeholder="Enter instruction step..."
            maxLength={1000}
            rows={3}
          />
          <div className="note-actions">
            <button onClick={() => moveNote(index, index - 1)} disabled={index === 0}>
              ↑
            </button>
            <button onClick={() => moveNote(index, index + 1)} disabled={index === notes.length - 1}>
              ↓
            </button>
            <button onClick={() => removeNote(index)}>Remove</button>
          </div>
        </div>
      ))}
      <button onClick={addNote}>Add Coach Note</button>
    </div>
  );
};
```

### Display Component

For displaying coach notes in read-only mode:

```javascript
const CoachNotesDisplay = ({ coachNotes }) => {
  if (!coachNotes || coachNotes.length === 0) {
    return <p>No instructions available.</p>;
  }

  const sortedNotes = [...coachNotes].sort((a, b) => a.order - b.order);

  return (
    <div className="coach-notes-display">
      <h3>Instructions</h3>
      <ol className="coach-notes-list">
        {sortedNotes.map((note) => (
          <li key={note.id} className="coach-note">
            {note.text}
          </li>
        ))}
      </ol>
    </div>
  );
};
```

## Validation Rules

1. **Text Length**: Each coach note text cannot exceed 1000 characters
2. **Order**: Must be a non-negative integer
3. **Uniqueness**: While not enforced by the API, avoid duplicate text for better UX

## Migration from Instructions

If you have existing code using the `instructions` field, here's how to migrate:

### Reading Data
```javascript
// Old way
const instructions = exercise.instructions;

// New way
const instructions = exercise.coachNotes
  .sort((a, b) => a.order - b.order)
  .map(note => note.text)
  .join('\n');
```

### Creating/Updating Data
```javascript
// Old way
const exerciseData = {
  instructions: "Step 1\nStep 2\nStep 3",
  // ... other fields
};

// New way
const steps = instructionsText.split('\n').filter(step => step.trim());
const exerciseData = {
  coachNotes: steps.map((step, index) => ({
    text: step.trim(),
    order: index
  })),
  // ... other fields
};
```

## Best Practices

1. **Keep Instructions Concise**: Each coach note should be a single, clear instruction
2. **Logical Ordering**: Arrange notes in the sequence they should be performed
3. **Avoid Redundancy**: Don't repeat information already in the description
4. **Use Active Voice**: "Position the bar" instead of "The bar should be positioned"
5. **Be Specific**: Include details about form, breathing, and common mistakes

## Testing Considerations

1. Test adding, editing, removing, and reordering coach notes
2. Verify order is maintained after operations
3. Test maximum text length validation
4. Test with empty coach notes array
5. Ensure proper handling of coach notes without IDs (new notes)
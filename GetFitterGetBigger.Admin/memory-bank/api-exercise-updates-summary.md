# Exercise API Updates Summary

This document summarizes the recent updates to the Exercise API endpoints, focusing on the Coach Notes and Exercise Types features.

## Key Changes

### 1. Instructions → Coach Notes Migration

The single `instructions` text field has been replaced with a structured `coachNotes` array:

**Before:**
- Single text field for all instructions
- Limited formatting options
- Difficult to manage step-by-step guidance

**After:**
- Array of coach notes, each with:
  - `id`: Unique identifier (generated by API)
  - `text`: Instruction text (max 1000 chars)
  - `order`: Display order (0-based)
- Better organization and reordering capabilities
- Clearer step-by-step presentation

### 2. New Exercise Types Feature

Exercises can now be categorized by type:
- **Warmup**: Preparation exercises
- **Workout**: Main training exercises
- **Cooldown**: Recovery exercises
- **Rest**: Rest periods

**Business Rule**: The "Rest" type cannot be combined with other types.

### 3. Updated Muscle Groups Structure

The muscle groups now include proper role information:

**Response Structure:**
```javascript
muscleGroups: [
  {
    muscleGroup: { id: "musclegroup-uuid", name: "Quadriceps" },
    role: { id: "musclerole-uuid", value: "Primary", name: "Primary" }
  }
]
```

**Request Structure:**
```javascript
muscleGroups: [
  {
    muscleGroupId: "musclegroup-uuid",
    muscleRoleId: "musclerole-uuid"
  }
]
```

## Updated Endpoints

### Exercise Endpoints

All exercise endpoints now use the new structure:

1. **GET /api/exercises** - Returns exercises with coach notes and exercise types
2. **GET /api/exercises/{id}** - Returns single exercise with full details
3. **POST /api/exercises** - Create with coach notes array and exercise type IDs
4. **PUT /api/exercises/{id}** - Update with coach notes array and exercise type IDs
5. **DELETE /api/exercises/{id}** - No changes

### New Reference Table Endpoints

**Exercise Types:**
- **GET /api/ReferenceTables/ExerciseTypes** - Get all exercise types
- **GET /api/ReferenceTables/ExerciseTypes/{id}** - Get by ID
- **GET /api/ReferenceTables/ExerciseTypes/ByValue/{value}** - Get by value

**Muscle Roles:**
- **GET /api/ReferenceTables/MuscleRoles** - Get all muscle roles (Primary, Secondary, Stabilizer)

## Implementation Checklist

### Backend (Already Completed)
- ✅ Database migration for coach notes
- ✅ Database migration for exercise types
- ✅ Updated DTOs and models
- ✅ Updated controllers and services
- ✅ Added validation rules
- ✅ Unit and integration tests

### Frontend (To Be Implemented)
- [ ] Update ExerciseService to handle new structure
- [ ] Create CoachNotesEditor component
- [ ] Create ExerciseTypeSelector component
- [ ] Update ExerciseForm to use new fields
- [ ] Update ExerciseList to display exercise types
- [ ] Add validation for Rest type exclusivity
- [ ] Update reference data loading to include new tables
- [ ] Migrate any existing instructions display to coach notes

## Quick Reference

### Creating an Exercise
```javascript
const newExercise = {
  name: "Barbell Squat",
  description: "Fundamental lower body exercise",
  coachNotes: [
    { text: "Position bar on upper back", order: 0 },
    { text: "Keep chest up, core engaged", order: 1 },
    { text: "Lower to parallel or below", order: 2 }
  ],
  exerciseTypeIds: ["exercisetype-workout-id"],
  difficultyId: "difficultylevel-intermediate-id",
  isUnilateral: false,
  muscleGroups: [
    {
      muscleGroupId: "musclegroup-quadriceps-id",
      muscleRoleId: "musclerole-primary-id"
    }
  ],
  equipmentIds: ["equipment-barbell-id"],
  // ... other fields
};
```

### Validating Exercise Types
```javascript
function validateExerciseTypes(selectedTypeIds, allTypes) {
  const selectedTypes = selectedTypeIds.map(id => 
    allTypes.find(t => t.id === id)
  );
  
  const hasRest = selectedTypes.some(t => t.value === 'Rest');
  const hasOthers = selectedTypes.some(t => t.value !== 'Rest');
  
  if (hasRest && hasOthers) {
    throw new Error('Rest type cannot be combined with other exercise types');
  }
}
```

## Related Documentation

- [Full API Integration Guide](./api-exercise-crud-integration.md)
- [Coach Notes Migration Guide](./api-coach-notes-migration.md)
- [Exercise Types Reference](./api-exercise-types-reference.md)
- [Reference Tables Overview](./features/reference-tables/overview.md)